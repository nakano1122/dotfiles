---
name: codex-cli
description: OpenAI Codex CLI をセカンドオピニオンとして活用するためのガイド。ソフトウェア設計の検証、厳格なコードレビュー、複雑なデバッグ仮説の取得に使用。Agent Teams での並列開発において、重要な設計判断やセキュリティレビューで別 AI の視点が欲しい時に使用。
---

# Codex CLI 活用ガイド

OpenAI Codex CLI を**セカンドオピニオン**として活用し、重要な判断の品質を高めるためのガイド。

## 位置づけ

- Codex CLI は Claude Code の**補助ツール**であり、メインの開発ツールではない
- 重要な設計判断・セキュリティレビュー・複雑なデバッグで**別の AI の視点**を取得するために使用する
- 最終的な判断・意思決定は常に Claude（オーケストレータ）が行う

## 基本コマンド

```bash
# 基本形: codex exec でプロンプトを実行
codex exec "プロンプト"

# モデル指定（推論が必要な場面では o3 を推奨）
codex exec --model o3 "プロンプト"

# ファイルの内容を含めて実行
cat ファイル | codex exec "プロンプト"

# git diff をパイプで渡してレビュー
git diff | codex exec "プロンプト"
```

## 主要フラグ

| フラグ | 説明 | 使用例 |
|--------|------|--------|
| `--model` | 使用モデルを指定 | `--model o3` |
| `--quiet` | 出力を最小限に抑制 | スクリプト内での利用時 |
| `--full-auto` | 承認なしで自動実行 | 信頼できる読み取り専用タスク |
| `--no-full-auto` | 承認付きで実行（デフォルト） | 安全性を重視する場合 |

## Agent Teams での活用パターン

### パターン 1: ソフトウェア設計のセカンドオピニオン

重要なアーキテクチャ判断や設計選択で、別の視点を得る。

```bash
codex exec --model o3 "
以下のソフトウェア設計について、問題点・改善案・見落としがないかレビューしてください。

## 設計内容
{設計の概要}

## 技術スタック
{使用技術}

## 制約
{制約条件}

特に以下の観点で評価してください:
1. スケーラビリティ
2. 保守性
3. セキュリティ
4. パフォーマンス
"
```

**使いどころ:**
- 新規アーキテクチャの採用判断
- 技術選定で複数の候補がある場合
- 大規模リファクタリングの方針決定

### パターン 2: 厳格なコードレビュー

git diff をパイプで渡し、セキュリティやパフォーマンスの観点で厳格にレビューする。

```bash
# 特定ブランチとの差分をレビュー
git diff feature/{機能名}...HEAD | codex exec --model o3 "
以下の差分を厳格にレビューしてください。

特に以下の観点で問題がないか確認してください:
1. セキュリティ脆弱性（インジェクション、XSS、CSRF、認証バイパス等）
2. パフォーマンス問題（N+1、メモリリーク、不要な再レンダリング等）
3. エラーハンドリングの漏れ
4. エッジケースの未処理
5. 並行処理の安全性

問題がある場合、ファイルパスと行番号を含めて具体的に指摘してください。
"
```

**使いどころ:**
- セキュリティクリティカルな機能のレビュー（認証、決済、個人情報処理等）
- Phase 3 の横断レビューでの補強
- 本番デプロイ前の最終チェック

### パターン 3: 複雑なデバッグ仮説

原因が特定できないバグについて、別の AI から仮説を得る。

```bash
codex exec --model o3 "
以下のバグについて、考えられる原因と調査手順を提案してください。

## 症状
{バグの症状}

## 再現手順
{再現手順}

## 環境
{環境情報}

## すでに試したこと
{調査済みの内容}

## 関連コード
$(cat {関連ファイル})
"
```

**使いどころ:**
- 通常のデバッグフローで原因が特定できない場合
- 間欠的に発生する問題
- 複数のシステムにまたがる問題

## オーケストレータからの呼び出し判断基準

以下の条件に該当する場合、Codex CLI の活用を検討する:

| 条件 | 活用パターン |
|------|-------------|
| アーキテクチャの大きな方針転換 | パターン 1: 設計セカンドオピニオン |
| セキュリティクリティカルな機能 | パターン 2: 厳格レビュー |
| 認証・認可フローの新規設計 | パターン 1 + 2 |
| 原因不明のバグが長時間解決しない | パターン 3: デバッグ仮説 |
| 本番デプロイ前の最終確認 | パターン 2: 厳格レビュー |
| 複数の設計案で迷っている | パターン 1: 設計セカンドオピニオン |

**呼び出さない場合:**
- 定型的な CRUD 実装
- 単純なバグ修正
- 小規模なリファクタリング
- 既に方針が確定している実装

## 注意事項

1. **補助ツールとしての位置づけ**: Codex CLI の出力はあくまで参考情報。最終判断は Claude（オーケストレータ）が行う
2. **機密情報の取り扱い**: API キー、パスワード、個人情報等の機密情報をプロンプトに含めない
3. **コスト意識**: Codex CLI の呼び出しにはコストが発生する。判断基準に基づき、必要な場面でのみ使用する
4. **出力の検証**: Codex CLI の指摘が正しいとは限らない。Claude 自身の知識と照合して判断する
5. **バージョン確認**: Codex CLI のバージョンやモデルの利用可能状況は変わりうるため、実行前にエラーハンドリングを考慮する
